# -*- snakemake -*-
#
import os
import re

try:
    from snakemakelib.bio.ngs.db import index
except:
    pass

include: "../settings.rules"

DEFAULT_RULES = ['ucsc_wigToBigWig', 'ucsc_bedGraphToBigWig']

config_default = {
    'bio.ngs.db.ucsc' : { 
        'ref' : config['bio.ngs.settings']['db']['ref'],
        #'build' : config['bio.ngs.settings']['db']['build'],
        'index' : "",
        'home' : "",
        'rules': DEFAULT_RULES,
        'urldownload' : 'http://hgdownload.cse.ucsc.edu/goldenPath/',
    },
}

configdefault: config_default

try:
    config['bio.ngs.db.ucsc']['index'] = index(
        ref = config['bio.ngs.db.ucsc']['ref'],
        index = config['bio.ngs.db.ucsc']['index'],
        build = config['bio.ngs.settings']['db']['build'],
        application = "ucsc",
    )
except:
    pass

for rule in config['bio.ngs.db.ucsc']['rules']:
    include: os.path.join("ucsc", rule + ".rule")

if config['bio.ngs.db.ucsc']['home']:
    os.environ["PATH"] += os.pathsep + config['bio.ngs.db.ucsc']['home']
for (section, cfg) in config['bio.ngs.db.ucsc'].items():
    if isinstance(cfg, dict):
        if cfg.get('cmd', "") and not is_installed(cfg.get('cmd', "")):
            raise Exception("\nbio.ngs.db.ucsc: {prog} not installed or not in PATH\n".format(prog=cfg.get('cmd')))
