# -*- snakemake -*-
include: '../settings.rules'
include: '../tools/bedtools.rules'

DEFAULT_RULES = ['rpkmforgenes_from_bam']

config_default = {
    'bio.ngs.rnaseq.rpkmforgenes' : {
        'rules' : DEFAULT_RULES,
        'home' : "",
        'cmd' : 'rpkmforgenes.py',
        'annotation' : config['bio.ngs.settings']['annotation']['transcript_annot_gtf'],
        'options' : "-readcount -fulltranscript -mRNAnorm -rmnameoverlap -bothendsceil",
        'unique' : "",
        'annot_format' : 'refFlat',
    },
}

config = update_config(config_default, config)

python2 = config['comp.settings']['python2']['activate_cmd']

try:
    from snakemakelib.bio.ngs.db import annotation
    # Update annotation
    config['bio.ngs.rnaseq.rpkmforgenes']['annotation'] = \
        annotation(annotation=config['bio.ngs.rnaseq.rpkmforgenes']['annotation'],
                   db_cfg=config['bio.ngs.settings']['db'],
                   fmt=config['bio.ngs.rnaseq.rpkmforgenes']['annot_format'])
except:
    pass

if config['bio.ngs.rnaseq.rpkmforgenes']['annot_format'] != "gtf":
    include: '../db/ucsc.rules'

